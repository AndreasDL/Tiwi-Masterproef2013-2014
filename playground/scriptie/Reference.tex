\begin{otherlanguage}{english}
\chapter{MonitoringAPI reference}
\label{REFERENCE}
\section{About}
This chapter will provide a detailed list of methods and functions available in the monitoringAPI. The monitoringAPI provides access to all the monitoringdata, both results and configuration. The API is available at http://f4f-mon-dev.intec.ugent.be/service/index.php , however this location is not permanent. In case the url returns 404, one should contact IBCN/iMinds. Keep in mind that the API is still under development, so things might change.
\npar
The service supports get and post requests, both are handled in the same way unless stated otherwise. A request should use http://f4f-mon-dev.intec.ugent.be/service/index.php/ as base url e.g. http://f4f-mon-dev.intec.ugent.be/service/index.php/$<$functionname$>$?$<$arguments$>$ \footnote{Of course the $<$ and $>$ shouldn't be in the actual url.}. 

\section{Introduction}
The system contains all information about the results, testbeds, testdefinitions, testinstances and the login information of users used for testing. It is important to note that these users are used by programs and are not logins for experimenters.  
\npar
A testdefinition is a definition of the test e.g. a ping test consists of a ping command while a login test uses the Aggregate manager to log in to a testbed. The definition describes the arguments used for and results returned from a test. Each definition has its own name, the testdefinitionname and an internal testtype named testtype this type tells the monitoringsservice whether or not to use the automated tester.
\npar
The testinstance on the other hand is an instance of a testdefinition e.g. a login test on the virtual wall. Each instance has an instanceid, a name and the name of its definition.

\section{Functions}
The functions needed for experimenters are listed below. Next up is a detailed explaination of each function. The current list of functions is:
\begin{enumerate}
\item List
\item Last
\item TestDefinition
\item TestInstance
\item Testbed
\item User
\item Q (GENI datastore support, use with caution)
\item AddResult (administrators only)
\item updateNextRun (administrators only)
\end{enumerate}
\npar
The return format of each call below can be change with ?format=$<$formatname$>$. 
Other than JSON as default format, PrettyJson is also available. PrettyJson uses the PHP JSON pretty print parameter to outline the resulting JSON making it more humanfriendly.
Use it by adding format=PrettyJson to any call.
\npar
It is also possible to use multiple values by using a comma separated list e.g. ...?testbed=wall1,wall2 will filter on testbed where the testbed is either wall1 or wall2.
\subsection{List}
\subsubsection{What}
The list function will list monitoring results. Because of performance and security reasons, only the last 100 results that comply with the query will be returned. Keep in mind that this is 100 for each testinstance, testbed combination. In case more is needed, one could use from and till clausules or contact IBCN/iMinds.

\clearpage

\subsubsection{Arguments}
\begin{enumerate}
\item testbed: the testbed of the corresponding result
\item testdefinitionname: the name of the testdefinition of the corresponding testbed.
\item resultid: the id of the result.
\item testname: the name of the corresponding test
\item from: search results after a given timestamp NOTE: use iso 8601 format WITH timezone.
\item till: search results before a given timestamp NOTE: use iso 8601 format WITH timezone.
\item count: the last $<$count$>$ results will be returned. Limited to 100 and default also 100. The results are counted for each combination of testbed en testdefinitionname, therefore list?count=50 will return the last 50 results for each test on each testbed, so when there are 2 testbeds, 100 results will be returned in total.
\end{enumerate}
\npar
It is important to note here that using from/till arguments in combination with count is not possible. Doing so will return a http 400 (bad request) error.
\subsubsection{Examples}
\begin{lt}
list?from=2014-03-18T19:29:00&till=2014-03-19T18:29:00&testdefinitionname=ping
&testbed=wall2
\end{lt}
Will return all the results of each\footnote{Although generally not recommended, it is possible to have multiple tests of the same type on one testbed.} pingtest on wall2 between 18/03/2014 18:29:00 and 19/03/2014 18:29:00.
\npar
\begin{lt}
list?testdefinitionname=stitch&count=5&testbed=wall2,wall1
\end{lt}
Will return results of the last 5 stitching results for wall2 and the last 5 stitching results for wall1.

\clearpage

\subsection{Last}
\subsubsection{What}
Last has the same functionality as list, but uses default count=1. It is a shortcut to get the last results of each test on each testbed.
\subsubsection{Arguments}
\begin{enumerate}
\item testbed: the testbed of the corresponding result
\item testdefinitionname: the name of the testdefinition of the corresponding testbed.
\item resultid: the id of the result.
\item testname: the name of the corresponding test
\item count: the last $<$count$>$ results will be returned. Limited to 100 and default also 100. The results are counted for each combination of testbed en testdefinitionname therefor list?count=50 will return the last 50 results for each test on each testbed, so when there are 2 testbeds, 100 results will be returned in total.
\end{enumerate}
\npar
Since last uses a default count, it is not possible to use from/till arguments here. Doing so will return a http 400 (bad request) error.
\subsubsection{Examples}
\begin{lt}
last?testdefinitionname=ping
\end{lt}
Will return the last result of each\footnote{Although generally not recommended, it is possible to have multiple tests of the same type on one testbed.} pingtest of each testbed.
\npar
\begin{lt}
last?testdefinitionname=stitch&count=5&testbed=wall2
\end{lt}
Will return results of the last 5 stitching tests for wall2. Note that this is also possible with list.
\npar
\begin{lt}
last
\end{lt}
Returns the last result of each test on each testbed.
\clearpage
\subsection{TestDefinition}
\subsubsection{What}
This call will return the testdefinitions. A testdefinition is used to define a test.
\subsubsection{Arguments}
\begin{enumerate}
\item testdefinitionname: the name of the testdefinition.
\item testtype: the internal testtype used to determine if the test uses the automated tester or a bash command. It is not recommended for experimenters to use this.
\end{enumerate}
\subsubsection{Examples}
\begin{lt}
testdefinition?testdefinitionname=ping,login2
\end{lt}
Will return the definition of the ping test and of the login (AMv2) test.
\\
\subsection{TestInstance}
\subsubsection{What}
This call will return the testinstance. A testinstance is an instance of the definition; the instance will define a pingtest on a certain testbed while a definition will define that a pingtest consists of a ping command. 
\subsubsection{Arguments}
\begin{enumerate}
\item testbed: the testbed used by the test
\item testdefinitionname: the name of the testdefinition.
\item testname: name of the test.
\item testinstanceid: the id of the testinstance.
\item nextrun: field used to determine the next execution of a test. formatted in iso 8601 WITH timestamps.
\end{enumerate}
\clearpage
\subsubsection{Examples}
\begin{lt}
testinstance?testdefinitionname=stitch&testbed=wall2
\end{lt}
Will return all the instances of the stitching type on wall2.
\begin{lt}
testinstance?nextrun=2014-06-19T12:00:00
\end{lt}
Will return all tests with nextrun $>=$ 19/06/2014 12:00:00; used by the monitoringsservice.\\

\subsection{Testbed}
\subsubsection{What}
This call will return the testbeds.
\subsubsection{Arguments}
\begin{enumerate}
\item testbedname: name of the testbed.
\item urn: urn of the testbed.
\item url: url of the testbed.
\end{enumerate}
\subsubsection{Examples}
\begin{lt}
testbed?urn=urn:publicid:IDN+wall1.ilabt.iminds.be+authority+cm
\end{lt}
Will return the information of the testbed with urn = \\
urn:publicid:IDN+wall1.ilabt.iminds.be+authority+cm (wall1).
\\
\subsection{User}
\subsubsection{What}
This call will return information about a user. Note that only users used by the monitoringservice are stored here, making it impossible to see information about all users on the testbed.
\subsubsection{Arguments}
\begin{enumerate}
\item username: the name of the users.
\item userauthorityurn: the urn of the user used for authentication.
\end{enumerate}
\subsubsection{Examples}
\begin{lt}
user?username=ftester
\end{lt}
Will return the information for the ftester user.
\\
\subsection{Q}
\subsubsection{What}
This function is not real function but an argument of the list function. It is used to make this monitoringAPI compatible with the GENI datastore. However since both GENI and this API are in developpment, not every function is yet available.
\subsubsection{Arguments}
The arguments here are encoded as a json string, for more information i refer to\\
http://groups.geni.net/geni/wiki/OperationalMonitoring and\\
http://groups.geni.net/geni/wiki/OperationalMonitoring/DatastorePolling.
\npar
Not all of these functions are supported only these:
\begin{enumerate}
\item aggragate: it is possible to filter on aggregate name.
\item eventType: the evenname as defined by genidatastore. 
\item ts: unix timestamp in micro( 1/1000000) seconds.
\begin{enumerate}
\item gte: greater than or equal.
\item lt: lower than.
\end{enumerate}
\end{enumerate}
\subsubsection{Example}
\begin{lt}
list?q={
  filters:{
    eventType:[ops_monitoring:is_available],
    obj:{type:aggregate,id:[wall2,wall1]}
  }
}
\end{lt}
Will return results of the is\textunderscore available\footnote{The is\textunderscore available is the GENI name for a getVersion test, so this call will return whether or not the getVersion test succeeded} test for wall1 and wall2.
\clearpage
\end{otherlanguage}
